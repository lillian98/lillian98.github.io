<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="format-detection" content="telephone=no" />
    <title>国庆游园会</title>
    <link rel="stylesheet" href="//static.360buyimg.com/jdcsh/babel/dist/css/parser.css">
</head>
<body>
<!-- tracking -->
<div class="tracking hide">
    <script type="text/javascript">
        var jap = {
            siteId:'MO-J2011-1', // 站点编号，替换jaq的account字段
            autoLogPv:true        //  页面加载后自动上报pv
        };
    </script>
    <script type="text/javascript" src="//wl.jd.com/unify.min.js"></script>
</div>
<!--S container -->
<div id="J_bableOpt" class="bab_opt_con" data-activityId="3SuRYXJPCmnjBnib1FUVhUmvTG3" data-pageId="11491">
    <!-- S import m_header -->
    <div id="m_common_header" class="bab_opt_header hide"></div>
    <!-- E import m_header -->

    <div class="bab_opt_content">
        <div class="bab_opt_loading jdui_load">
            <span class="jdui_load_in"></span>
        </div>
        <div id="J_bableOptPage" class="bab_opt_page">
            <div class="bab_opt_mod bab_opt_mod_1 customcode" data-floorNum="1" data-template="customcode">
	<textarea class="template_code hide">
		<div class="wrapper"></div>
	</textarea>
            </div>
        </div>
        <div class="bab_opt_footer hide"></div>
    </div>
</div>
<style>
    .wrapper{
        position:fixed; top:0; left:0; z-index:109;
        width:100%; height:100%;
    }
    .wrapper-start{
        position:relative; top:50%; margin-top:-60%;
        -webkit-transform:scale(.9);
    }
    #closeBtn1{
        position:absolute; right:7.5%; top:18.7%;
        width:12.5%; height:11.1%;
    }
    #startBtn{
        position:absolute; left:37.5%; bottom:4.7%;
        width:42.3%; height:9.7%;
    }
    .wrapper-process{
        position:fixed; bottom:0; left:0; z-index:111;
        width:100%; /*height:30.4%;*/
    }
    .process-list{
        position:absolute; bottom:35%; left:50%;
        width:100%; height:51.4%; margin-left:-50%;
        -webkit-transform:scale(.9);
    }
    .process-item{
        position:relative;
        display:inline-block; width:23.9%; height:100%;
        background:url(//m.360buyimg.com/mobilecms/jfs/t3019/175/2167262708/5923/11437e1e/57d27d42Ncab98fe9.png) center 0 no-repeat; background-size:100% 100%;
    }
    .process-line{
        position:absolute; bottom:4%; left:0;
        width:100%;
        -webkit-transform:scale(.9);
    }
    #processBar2{
        position:absolute; top:0; left:0;
        width:0%; height:100%;
        background:url(//m.360buyimg.com/mobilecms/jfs/t3061/203/1731480694/3353/d33fb9b7/57d27d43Nd754e7bf.png) 0 0 no-repeat; background-size:100% 100%;
    }
    .wrapper-fail{
        position:absolute; top:50%; left:50%;
        margin-top:-40%; margin-left:-50%; width:100%;
        -webkit-transform:scale(.9);
    }
    #closeBtn3{
        position:absolute; right:1.5%; top:5.7%;
        width:18.5%; height:33%;
    }
    .wrapper-success{
        position:absolute; top:50%; left:50%;
        margin-top:-60%; margin-left:-50%; width:100%;
        -webkit-transform:scale(.9);
    }
    #successText{
        position:absolute; top:35.7%; left:50%;
        width:46.6%; margin-left:-23.3%;
    }
    #closeBtn2{
        position:absolute; right:7.5%; top:25.7%;
        width:12.5%; height:11.1%;
    }
    #backBtn{
        position:absolute; left:8.5%; bottom:1%;
        width:38.3%; height:11%;
    }
    #shareBtn{
        position:absolute; left:52.5%; bottom:1%;
        width:38.3%; height:11%;
    }
    .wrapper-share{
        position:absolute; top:50%; left:50%;
        margin-top:-60%; margin-left:-50%; width:100%;
        -webkit-transform:scale(.9);
    }
    #tryBtn{
        position:absolute; left:30.5%; bottom:10%;
        width:38.3%; height:11%;
    }
    #wrapperIcons{
        position:absolute; top:0; left:0; z-index:110;
        width:100%; height:10000px; overflow:hidden;
    }
    .wrapper-icon-item{
        position:absolute; top:-100px; left:-100px;
        width:13.9%;
        -webkit-transform:scale(1.5);transform:scale(1.5);
    }
    .wrapper-icon-item.active{
        -webkit-border-radius:50%;
        border-radius:50%;
        background:url(//m.360buyimg.com/mobilecms/jfs/t3151/136/1700595297/6246/616d943a/57d27d42N6737575e.png) center center no-repeat; background-size:200% 200%;
    }
    #wrapperTips{
        color:#fff; text-align:center; font-weight:bolder; font-size:18px;
        display:none; margin-top:50%;
    }
    .wrapper-error,.wrapper-getting{
        position:absolute; top:50%; left:50%;
        margin-top:-40%; margin-left:-50%; width:100%;
        -webkit-transform:scale(.9);
    }
</style>
<div class="wrapper" id="wrapper">
    <div class="wrapper-start" id="wrapperStart">
        <img src="//m.360buyimg.com/mobilecms/jfs/t3151/126/1806863916/113349/8ec0e7d2/57d3b1b2Nba3afd4c.png"
             alt="">
        <a href="javascript:;" id="closeBtn1" report-eventid="Babel_CodeContent"
           report-eventparam="ID_http://h5.m.jd.com/active/3wX17ys13EaDtijVP6KnfrBucNhV/index.html"
           report-pagename="http://h5.m.jd.com/active/3wX17ys13EaDtijVP6KnfrBucNhV/index.html"
           report-pageparam="" report-eventlevel="4"></a>
        <a href="javascript:;" id="startBtn" report-eventid="Babel_CodeContent"
           report-eventparam="ID_http://h5.m.jd.com/active/3wX17ys13EaDtijVP6KnfrBucNhV/index.html"
           report-pagename="http://h5.m.jd.com/active/3wX17ys13EaDtijVP6KnfrBucNhV/index.html"
           report-pageparam="" report-eventlevel="4"></a>
    </div>

    <div class="wrapper-fail" id="wrapperFail">
        <img src="//m.360buyimg.com/mobilecms/jfs/t3166/354/1734982838/17240/c7434147/57d2e5f7N321e5a50.png"
             alt="">
        <a href="javascript:;" id="closeBtn3" report-eventid="Babel_CodeContent"
           report-eventparam="ID_http://h5.m.jd.com/active/3wX17ys13EaDtijVP6KnfrBucNhV/index.html"
           report-pagename="http://h5.m.jd.com/active/3wX17ys13EaDtijVP6KnfrBucNhV/index.html"
           report-pageparam="" report-eventlevel="4"></a>
    </div>
    <div class="wrapper-success" id="wrapperSuccess">
        <img src="//m.360buyimg.com/mobilecms/jfs/t3103/170/1725959071/77851/2383218b/57d2de27N44a9cee6.png" alt="">
        <img src="//h5.m.jd.com/active/YHxu7oUPY8tTHjqCTVFGwkp1LU1/pages/8782/img/success-text-3.png" alt=""
             id="successText">
        <a href="javascript:;" id="closeBtn2" report-eventid="Babel_CodeContent"
           report-eventparam="ID_http://h5.m.jd.com/active/3wX17ys13EaDtijVP6KnfrBucNhV/index.html"
           report-pagename="http://h5.m.jd.com/active/3wX17ys13EaDtijVP6KnfrBucNhV/index.html"
           report-pageparam="" report-eventlevel="4"></a>
        <a href="javascript:;" id="backBtn" report-eventid="Babel_CodeContent"
           report-eventparam="ID_http://h5.m.jd.com/active/3wX17ys13EaDtijVP6KnfrBucNhV/index.html"
           report-pagename="http://h5.m.jd.com/active/3wX17ys13EaDtijVP6KnfrBucNhV/index.html"
           report-pageparam="" report-eventlevel="4"></a>
        <a href="javascript:;" id="shareBtn" report-eventid="Babel_CodeContent"
           report-eventparam="ID_http://h5.m.jd.com/active/3wX17ys13EaDtijVP6KnfrBucNhV/index.html"
           report-pagename="http://h5.m.jd.com/active/3wX17ys13EaDtijVP6KnfrBucNhV/index.html"
           report-pageparam="" report-eventlevel="4"></a>
    </div>
    <div class="wrapper-share" id="wrapperShare">
        <img src="//m.360buyimg.com/mobilecms/jfs/t2998/185/2173863610/87788/ef876486/57d27d42Nc9d2bd70.png"
             alt="">
        <a href="javascript:;" id="tryBtn" report-eventid="Babel_CodeContent"
           report-eventparam="ID_http://h5.m.jd.com/active/3wX17ys13EaDtijVP6KnfrBucNhV/index.html"
           report-pagename="http://h5.m.jd.com/active/3wX17ys13EaDtijVP6KnfrBucNhV/index.html"
           report-pageparam="" report-eventlevel="4"></a>
    </div>
    <div id="wrapperTips"></div>
    <div class="wrapper-error" id="wrapperError">
        <img src="//m.360buyimg.com/mobilecms/jfs/t3022/15/2149587289/17689/18af513d/57d2de25N38dea8f7.png" alt="">
    </div>
    <div class="wrapper-getting" id="wrapperGetting">
        <img src="//m.360buyimg.com/mobilecms/jfs/t3079/334/1764323593/16645/95411be8/57d2de24N4552dcd0.png" alt="">
    </div>
</div>
<div class="wrapper-process" id="wrapperProcess">
    <img src="//m.360buyimg.com/mobilecms/jfs/t3280/160/1738405702/8286/5b29eb97/57d27d42N7db41f82.png"
         alt="">
    <div class="process-list" id="processList">
        <div class="process-item process-item-1"></div>
        <div class="process-item process-item-2"></div>
        <div class="process-item process-item-3"></div>
        <div class="process-item process-item-4"></div>
    </div>
    <div class="process-line">
        <img src="//m.360buyimg.com/mobilecms/jfs/t3286/206/1763023785/3315/ef628e5f/57d27d42Ncee131a8.png"
             alt="">
        <div id="processBar2"></div>
    </div>
</div>


<script type="text/javascript">
    window.PreLoad = function (a, b) {
        var c = b || {};
        this.source = a, this.count = 0, this.total = a.length, this.onload = c.onload, this.prefix = c.prefix || "", this.init()
    };
    PreLoad.prototype.init = function () {
        var a = this;
        a.source.forEach(function (b) {
            var c = b.substr(b.lastIndexOf(".") + 1).toLowerCase(), d = a.prefix + b;
            switch (c) {
                case"js":
                    a.script.call(a, d);
                    break;
                case"css":
                    a.stylesheet.call(a, d);
                    break;
                case"svg":
                case"jpg":
                case"gif":
                case"png":
                case"jpeg":
                    a.image.call(a, d)
            }
        })
    }, PreLoad.prototype.getProgress = function () {
        return Math.round(this.count / this.total * 100)
    }, PreLoad.prototype.image = function (a) {
        var b = document.createElement("img");
        this.load(b, a), b.src = a
    }, PreLoad.prototype.stylesheet = function (a) {
        var b = document.createElement("link");
        this.load(b, a), b.rel = "stylesheet", b.type = "text/css", b.href = a, document.head.appendChild(b)
    }, PreLoad.prototype.script = function (a) {
        var b = document.createElement("script");
        this.load(b, a), b.type = "text/javascript", b.src = a, document.head.appendChild(b)
    }, PreLoad.prototype.load = function (a, b) {
        var c = this;
        a.onload = a.onerror = a.onabort = function (a) {
            c.onload && c.onload({count: ++c.count, total: c.total, item: b, type: a.type})
        }
    };
</script>

<script type="text/javascript">

    Array.prototype.unique = function () {
        this.sort();
        var re = [this[0]];
        for (var i = 1; i < this.length; i++) {
            if (this[i] !== re[re.length - 1]) {
                re.push(this[i]);
            }
        }
        return re;
    };

    require(['zepto', 'http://h5.m.jd.com/active/YHxu7oUPY8tTHjqCTVFGwkp1LU1/pages/8782/js/jdShare.js'], function ($, jdShare) {

        var getCookie = function (name) {
            var strCookie = document.cookie;
            var arrCookie = strCookie.split("; ");
            for (var i = 0; i < arrCookie.length; i++) {
                var arr = arrCookie[i].split("=");
                if (name == arr[0]) {
                    return arr[1];
                }
            }
            return "";
        };

        var getQueryString = function (name) {
            var reg = new RegExp('(^|&)' + name + '=([^&]*)(&|$)', 'i');
            var r = window.location.search.substr(1).match(reg);
            if (r != null) {
                return unescape(r[2]);
            }
            return null;
        };

        var maskHtml = '<div id="wrapperMask" style="display:none;position:fixed;top:0;left:0;z-index:100;width:100%;height:100%;background-color:rgba(0,0,0,.5);"></div>';

        var mask = (function () {

            var can_not_move = function () {
                return false;
            };

            $('body').append(maskHtml);

            return {
                show: function () {
                    $('#wrapper').show();
                    $('#wrapperMask').show();
                    $('body,html')
                            .on('touchmove', can_not_move);
                },
                hide: function () {
                    $('#wrapper').hide();
                    $('#wrapperMask').hide();
                    $('body,html')
                            .off('touchmove', can_not_move);
                }
            };
        })();

        var tips = (function (text) {
            return {
                show: function () {
                    $('#wrapperTips').html(text).show();
                },
                hide: function () {
                    $('#wrapperTips').hide();
                },
            }
        })();

        var process = (function () {
            var processBar2 = document.getElementById('processBar2'), percent = 0, duration = 20, startTime;

            percent = 100;

            processBar2.style.cssText = 'width:' + percent + '%;background-size:' + (100 / percent * 100) + '% 100%;';

            var next = function (s) {
                floor.close();
                mask.show();
                console.log(s);
                if (s > 0) {
                    state.success(s);
                } else {
                    state.fail();
                }
            };

            return {
                go  : function () {
                    $('#wrapper').show();
                    $('#wrapperProcess').show();

                    floor.open();

                    startTime = Date.now();
                    requestAnimationFrame(function c() {

                        percent = ((Date.now() - startTime) / (duration * 10));
                        if (percent < 100.0) {
                            processBar2.style.cssText = 'width:' + percent + '%;background-size:' + (100 / percent * 100) + '% 100%;';
                            if (!floor.check()) {
                                requestAnimationFrame(c);
                            } else {
                                next(1);
                            }
                        } else {
                            next(-1);
                        }

                    });
                },
                next: function (s) {
                    next(s);
                }
            };
        })();

        var floor = (function () {
            var list = [], items = [
                {
                    id  : 1,
                    src1: '//h5.m.jd.com/active/YHxu7oUPY8tTHjqCTVFGwkp1LU1/pages/8782/img/icon-1-s.png',
                    src2: '//h5.m.jd.com/active/YHxu7oUPY8tTHjqCTVFGwkp1LU1/pages/8782/img/icon-1.png'
                },
                {
                    id  : 2,
                    src1: '//h5.m.jd.com/active/YHxu7oUPY8tTHjqCTVFGwkp1LU1/pages/8782/img/icon-2-s.png',
                    src2: '//h5.m.jd.com/active/YHxu7oUPY8tTHjqCTVFGwkp1LU1/pages/8782/img/icon-2.png'
                },
                {
                    id  : 3,
                    src1: '//h5.m.jd.com/active/YHxu7oUPY8tTHjqCTVFGwkp1LU1/pages/8782/img/icon-3-s.png',
                    src2: '//h5.m.jd.com/active/YHxu7oUPY8tTHjqCTVFGwkp1LU1/pages/8782/img/icon-3.png'
                },
                {
                    id  : 4,
                    src1: '//h5.m.jd.com/active/YHxu7oUPY8tTHjqCTVFGwkp1LU1/pages/8782/img/icon-4-s.png',
                    src2: '//h5.m.jd.com/active/YHxu7oUPY8tTHjqCTVFGwkp1LU1/pages/8782/img/icon-4.png'
                },
            ];

            var style, positions = [
                {id: 1, top: 150, left: 13},
                {id: 2, top: 365, left: 32},
                {id: 3, top: 628.375, left: 90},
                {id: 4, top: 980.265, left: 20},
                {id: 5, top: 1246.696, left: 5},
                {id: 6, top: 1391, left: 85},
                {id: 7, top: 1623.721, left: -5},
                {id: 8, top: 1817.04, left: 35},
            ];

            var $page = $('#J_bableOptPage');
            var pageHeight = $page.height();
            //pageHeight=4758.13;

            var html = '<div id=wrapperIcons style="height:' + pageHeight + 'px;">';
            list = list.concat(items).concat(items);
            list.sort(function () {
                return Math.random() > 0.5;
            });
            $.each(list, function (key, value) {
                style = positions[key];
                html += '<div class="wrapper-icon-item" id="wrapperIconItem' + (key + 1) + '" data-id="' + value.id +
                        '" style="top:' + (style.top / pageHeight * 100) + '%;left:' + style.left + '%;"><img src="' + value.src1 + '" alt=""></div>';
            });
            html += '</div>';

            var _list = [], _item = null;
            var collect = function (id) {
                $.each(items, function (key, value) {
                    if (value.id == id) {
                        _item = value;
                        return false;
                    }
                });
                _list.push(id);
                _list = _list.unique();
                $('.process-item-' + id, '#processList')
                        .css({
                            backgroundImage: 'url(' + _item.src2 + ')'
                        });
            };

            var check = function () {
                if (_list.length == 4) {
                    return true;
                }
                return false;
            };

            return {
                open : function () {
                    $('#wrapperProcess')
                            .before(html);
                    $('.wrapper-icon-item', '#wrapperIcons')
                            .on('tap', function () {
                                collect($(this).data('id'));
                                $(this).addClass('active').fadeOut(200);
                            });
                },
                close: function () {
                    $('#wrapperIcons').remove();
                    $('#wrapperProcess').hide();
                },
                check: function () {
                    return check();
                },
                res  : function () {
                    var l = [];
                    $.each(items, function (key, value) {
                        l.push(value.src1);
                        l.push(value.src2);
                    });
                    return l;
                },
            };
        })();

        var state = (function () {

            var list = [
                {
                    id : 1,
                    src: '//h5.m.jd.com/active/YHxu7oUPY8tTHjqCTVFGwkp1LU1/pages/8782/img/success-text-1.png'
                },
                {
                    id : 2,
                    src: '//h5.m.jd.com/active/YHxu7oUPY8tTHjqCTVFGwkp1LU1/pages/8782/img/success-text-2.png'
                },
                {
                    id : 3,
                    src: '//h5.m.jd.com/active/YHxu7oUPY8tTHjqCTVFGwkp1LU1/pages/8782/img/success-text-3.png'
                },
                {
                    id : 4,
                    src: '//h5.m.jd.com/active/YHxu7oUPY8tTHjqCTVFGwkp1LU1/pages/8782/img/success-text-4.png'
                },
                {
                    id : 5,
                    src: '//h5.m.jd.com/active/YHxu7oUPY8tTHjqCTVFGwkp1LU1/pages/8782/img/success-text-5.png'
                },
                {
                    id : 6,
                    src: '//h5.m.jd.com/active/YHxu7oUPY8tTHjqCTVFGwkp1LU1/pages/8782/img/success-text-6.png'
                },
                //{id: 7, src: '//h5.m.jd.com/active/YHxu7oUPY8tTHjqCTVFGwkp1LU1/pages/8782/img/success-text-7.png'},
                {
                    id : 8,
                    src: '//h5.m.jd.com/active/YHxu7oUPY8tTHjqCTVFGwkp1LU1/pages/8782/img/success-text-8.png'
                },
                {
                    id : 9,
                    src: '//h5.m.jd.com/active/YHxu7oUPY8tTHjqCTVFGwkp1LU1/pages/8782/img/success-text-9.png'
                },
                {
                    id : 10,
                    src: '//h5.m.jd.com/active/YHxu7oUPY8tTHjqCTVFGwkp1LU1/pages/8782/img/success-text-10.png'
                },
            ];

            return {
                success: function (id) {
                    //tips.show('寻宝通关成功!正在抽奖中...');
                    $('#wrapperGetting')
                            .fadeIn(500, function () {
                                apis.lottery(list);
                            });
                },
                fail   : function () {
                    $('#wrapperFail')
                            .fadeIn();
                },
                close  : function () {
                    mask.hide();
                    $('#wrapperSuccess,#wrapperFail,#wrapperShare')
                            .fadeOut();
                },
                res    : function () {
                    var l = [];
                    $.each(list, function (key, value) {
                        l.push(value.src);
                    });
                    return l;
                },
            };

        })();

        var start = (function () {

            return {
                show : function () {
                    var xunbao = [null, 0];
                    if (window.localStorage) {
                        xunbao = localStorage.getItem('c3_xunbao_game');
                        xunbao = xunbao ? xunbao.split(',') : [0, +new Date()];
                        if (xunbao[0] > 0 && (new Date(parseInt(xunbao[1]))).getDate() < (new Date()).getDate()) {
                            xunbao = [0, +new Date()];
                        }
                    }

                    if (xunbao[0] == null ||xunbao[0] == undefined || xunbao[0] < 4) {
                        $('#wrapperShare')
                                .hide();
                        mask.show();
                        $('#wrapperStart')
                                .fadeIn();

                        xunbao[0]++;
                        xunbao[1] = +new Date();
                        localStorage.setItem('c3_xunbao_game', xunbao);
                    }
                },
                hide   : function () {
                    mask.hide();
                    $('#wrapperStart')
                            .fadeOut();
                },
                showTry: function () {
                    mask.show();
                    $('#wrapperShare')
                            .fadeIn();
                }
            };
        })();

        var apis = (function () {

            var _sid = null;

            var jiang0 = function (r) {
                var lotteryContent = r.data.lotteryContent;
                var id = parseInt(lotteryContent.split('|')[0]);
                console.log(r);
                $.each(r.list, function (key, value) {
                    if (id == value.id) {
                        item = value;
                        return false;
                    }
                });
                $('#successText').attr('src', item.src);
                $('#wrapperSuccess')
                        .fadeIn();
            };

            var jiang1 = function () {
                //alert('很遗憾,未中奖!');
                $('#wrapperError')
                        .fadeIn();
                setTimeout(function () {
                    $('#closeBtn2')
                            .trigger('click');
                }, 3000);
            };

            var jiang = [
                {code: '0', text: '中奖', func: jiang0},
                {code: '1', text: '未中奖', func: jiang1},
                {code: '1-1', text: '活动尚未开始', func: jiang1},
                {code: '1-2', text: '活动已经结束', func: jiang1},
                {code: '1-3', text: '该抽奖组件尚未开始', func: jiang1},
                {code: '1-4', text: '该抽奖组件已经结束', func: jiang1},
                {code: '3-1', text: '用户风险等级不满足', func: jiang1},
                {code: '3-2', text: '等级不够', func: jiang1},
                {code: '4-2', text: '抽奖次数不足', func: jiang1},
                {code: '4-5', text: '中奖次数不足', func: jiang1},
                {code: '5-1', text: '优惠券库存扣减失败', func: jiang1},
                {code: '5-2', text: '优惠券发放失败', func: jiang1},
                {code: '5-3', text: '保存领奖信息失败', func: jiang1},
                {code: '5-4', text: '更新用户领奖信息失败', func: jiang1},
                {code: '6-1', text: '未中奖', func: jiang1},
                {code: '6-2', text: '优惠券发发数量限制', func: jiang1},
                {code: '6-3', text: '该组件的优惠券全部发完', func: jiang1},
                {code: '6-4', text: '该分期的优惠券全部发完', func: jiang1},
            ];

            var jiangFunc = function (data, list) {
                $('#wrapperGetting').fadeOut();
                console.log(data);
                switch (data.code) {
                    case '3':
                        console.log('未登录');
                        window.parent.location.href = 'https://passport.m.jd.com/user/login.action?v=1&returnurl=' + encodeURIComponent(window.parent.location.href);
                        break;
                    case '0':
                        console.log('通信成功');
                        $.each(jiang, function (key, value) {
                            if (value.code == data.subCode) {
                                if (value.func != '') {
                                    value.func.call(this, {data : data, list : list});
                                }
                                return false;
                            }
                        });
                        break;
                    case '1':
                        console.log('通信失败');
                        break;
                        tips.hide();
                }
            };

            return {
                isLogin     : function () {
                    var sid = getQueryString('sid') || getCookie('sid');
                    console.log(sid);
                    return $.get('http://h5.m.jd.com/h5api.jsp?functionid=h5CheckLogin&sid=' + sid, function (r) {
                        if (typeof r == 'string') {
                            r = JSON.parse(r);
                        }
                        if (r.errno == 0 && r.code == '0') {
                            _sid = r.sid;
                            start.hide();
                            process.go();
                            return _sid;
                        } else {
                            window.parent.location.href = 'https://passport.m.jd.com/user/login.action?v=1&returnurl=' + encodeURIComponent(window.parent.location.href);
                            return false;
                        }
                    });
                },
                lottery     : function (list) {
                    babel.babelActivityLuckDraw({
                        data   : {
                            sid: _sid,//sessionId
                            aid: 'qPm9rEHTDkZyqqSVukJUifH9Vtu',//activityId
                            pid: '9075',//pageId
                            mid: '42rJxc5opUhDw1TXTnEG1daGf6X'//moduleId
                        },
                        success: function (r) {
                            setTimeout(function () {
                                jiangFunc(r, list);
                            }, 1000);
                        },
                        error  : function (r) {
                            console.log(r);
                            //alert('很遗憾,未中奖!');
                            $('#wrapperError')
                                    .fadeIn();
                            setTimeout(function () {
                                $('#closeBtn2')
                                        .trigger('click');
                            }, 3000);
                        }
                    });
                },
                queryLottery: function (func) {
                    _sid = getQueryString('sid') || getCookie('sid');
                    console.log(_sid);
                    $.get('http://h5.m.jd.com/h5api.jsp', {
                        functionid: 'babelQueryActivity',
                        body      : JSON.stringify({
                            "activityId": "qPm9rEHTDkZyqqSVukJUifH9Vtu",
                            "pageId"    : "9075",
                            "moduleId"  : "42rJxc5opUhDw1TXTnEG1daGf6X"
                        }),
                        sid       : _sid,
                        env       : 'beta'
                    }, func);
                }
            }

        })();

        var loadImg = function (func) {
            var tasks = (function () {
                var list = [
                    '//m.360buyimg.com/mobilecms/jfs/t2998/185/2173863610/87788/ef876486/57d27d42Nc9d2bd70.png',//share-bg.png
                    '//m.360buyimg.com/mobilecms/jfs/t3151/126/1806863916/113349/8ec0e7d2/57d3b1b2Nba3afd4c.png',//start-bg.png
                    '//m.360buyimg.com/mobilecms/jfs/t3286/206/1763023785/3315/ef628e5f/57d27d42Ncee131a8.png',//process-bar-1.png
                    '//m.360buyimg.com/mobilecms/jfs/t3061/203/1731480694/3353/d33fb9b7/57d27d43Nd754e7bf.png',//process-bar-2.png
                    '//m.360buyimg.com/mobilecms/jfs/t3280/160/1738405702/8286/5b29eb97/57d27d42N7db41f82.png',//process-bg.png
                    '//m.360buyimg.com/mobilecms/jfs/t3019/175/2167262708/5923/11437e1e/57d27d42Ncab98fe9.png',//process-icon.png
                    //'//m.360buyimg.com/mobilecms/jfs/t3133/156/1703146621/4003/c95c9fd7/57d27d43N532e3071.png',//close.png
                    '//m.360buyimg.com/mobilecms/jfs/t3166/354/1734982838/17240/c7434147/57d2e5f7N321e5a50.png',//fail.png
                    '//m.360buyimg.com/mobilecms/jfs/t3103/170/1725959071/77851/2383218b/57d2de27N44a9cee6.png',//success-bg.png
                    '//m.360buyimg.com/mobilecms/jfs/t3151/136/1700595297/6246/616d943a/57d27d42N6737575e.png',//icon-light.png
                    '//m.360buyimg.com/mobilecms/jfs/t3079/334/1764323593/16645/95411be8/57d2de24N4552dcd0.png',//getting.png
                    '//m.360buyimg.com/mobilecms/jfs/t3022/15/2149587289/17689/18af513d/57d2de25N38dea8f7.png',//error.png
                ];
                list = list.concat(floor.res().concat(state.res()));
                console.log(list);
                return list;
            })();

            new PreLoad(tasks, {
                onload: function (load) {
                    if (load.count == 6) {
                        func();
                    }
                }
            });
        };

        var init = (function () {
            try {
                jdShare && jdShare.setShareInfo({
                    title   : 'Apple新品首发预约  全民寻宝赢免单神券!',
                    content : 'Apple新品首发预约  全民寻宝赢免单神券!',
                    url     : 'http://h5.m.jd.com/active/3wX17ys13EaDtijVP6KnfrBucNhV/index.html',
                    img     : 'http://img12.360buyimg.com/cms/jfs/t3052/363/1513970130/12752/bb074aac/57ce649bNb5a7ef99.jpg',
                    channel : '',
                    callback: null
                });
            } catch (e) {
                if (e.name === "JdShareException") {
                    alert(e.toString());
                } else {
                    alert(e.message)
                }
            }

            var times = 0;

            apis.queryLottery(function (r) {
                times++;
                if (typeof r == 'string') {
                    r = JSON.parse(r);
                }
                if (r.errno == '0' && r.subCode == '1') {
                    if (times < 3) {
                        apis.queryLottery(arguments.callee);
                    } else {
                        loadImg(function () {
                            var value = getQueryString('resourceValue');
                            var leftLuckDrawNum = parseInt(r.leftLuckDrawNum);
                            console.log(leftLuckDrawNum);
                            if (navigator.userAgent.toLowerCase().indexOf('jdapp') != -1) {
                                start.show();
                            } else {
                                if (value == null) {
                                    start.show();
                                } else {
                                    start.showTry();
                                }
                            }
                        });
                    }
                } else {
                    var value = getQueryString('resourceValue');
                    var leftLuckDrawNum = parseInt(r.leftLuckDrawNum);
                    console.log(leftLuckDrawNum);
                    if (leftLuckDrawNum != NaN && r.leftLuckDrawNum > 0) {
                        loadImg(function () {
                            if (navigator.userAgent.toLowerCase().indexOf('jdapp') != -1) {
                                start.show();
                            } else {
                                if (value == null) {
                                    start.show();
                                } else {
                                    start.showTry();
                                }
                            }
                        });
                    }
                }
            });
        })();

        $('#startBtn')
                .on('tap', function () {
                    apis.isLogin();
                    return false;
                });
        $('#tryBtn')
                .on('tap', function () {
                    start.show();
                    return false;
                });
        $('#closeBtn1')
                .on('click', function () {
                    start.hide();
                    return false;
                });
        $('#closeBtn2,#backBtn,#closeBtn3')
                .on('click', function () {
                    state.close();
                    return false;
                });
        $('#shareBtn')
                .on('tap', function () {
                    try {
                        jdShare && jdShare.callSharePane({
                            title   : 'Apple新品首发预约  全民寻宝赢免单神券!',
                            content : 'Apple新品首发预约  全民寻宝赢免单神券!',
                            url     : 'http://h5.m.jd.com/active/3wX17ys13EaDtijVP6KnfrBucNhV/index.html',
                            img     : 'http://img12.360buyimg.com/cms/jfs/t3052/363/1513970130/12752/bb074aac/57ce649bNb5a7ef99.jpg',
                            channel : '',
                            callback: function () {
                                $('#closeBtn2').trigger('click');
                            }
                        });
                    } catch (e) {
                        if (e.name === "JdShareException") {
                            alert(e.toString());
                        } else {
                            alert(e.message)
                        }
                    }
                    return false;
                });


    })
    ;

</script>
<!--E container -->


<script src="//static.360buyimg.com/jdcsh/babel/dist/js/babelparser.js" async defer></script>
</body>
</html>